name: ğŸ”— Tailscale VPN Deployment

on:
  workflow_dispatch:
    inputs:
      send-email:
        description: 'Send credentials email'
        required: true
        type: boolean
        default: true
      recipient-email:
        description: 'Recipient email address (optional)'
        required: false
        type: string
        default: ''
  schedule:
    - cron: '0 */6 * * *'
  push:
    branches: [ main ]
    paths:
      - 'scripts/tailscale-setup.ps1'
      - 'scripts/email-notifier.ps1'

env:
  TAILSCALE_AUTH_KEY: ${{ secrets.TAILSCALE_AUTH_KEY }}
  GMAIL_USER: ${{ secrets.GMAIL_USER }}
  GMAIL_PASS: ${{ secrets.GMAIL_PASS }}

jobs:
  validate-config:
    name: âœ… Validate Configuration
    runs-on: ubuntu-latest
    timeout-minutes: 5
    outputs:
      has-tailscale-key: ${{ steps.check.outputs.has-tailscale }}
      has-gmail-config: ${{ steps.check.outputs.has-gmail }}
      recipient-email: ${{ steps.check.outputs.recipient }}
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ” Check Secrets
        id: check
        shell: pwsh
        run: |
          Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
          Write-Host "â•‘         âœ… CONFIGURATION VALIDATION                       â•‘" -ForegroundColor Cyan
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
          
          $hasErrors = $false
          
          # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Tailscale
          if ("${{ secrets.TAILSCALE_AUTH_KEY }}" -eq "") {
              Write-Host "âŒ TAILSCALE_AUTH_KEY is not set!" -ForegroundColor Red
              $hasErrors = $true
              "has-tailscale=false" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
          } else {
              Write-Host "âœ… TAILSCALE_AUTH_KEY is configured" -ForegroundColor Green
              "has-tailscale=true" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
          }
          
          # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Gmail
          $gmailComplete = $true
          if ("${{ secrets.GMAIL_USER }}" -eq "") {
              Write-Host "âŒ GMAIL_USER is not set!" -ForegroundColor Red
              $gmailComplete = $false
          } else {
              Write-Host "âœ… GMAIL_USER is configured" -ForegroundColor Green
          }
          
          if ("${{ secrets.GMAIL_PASS }}" -eq "") {
              Write-Host "âŒ GMAIL_PASS is not set!" -ForegroundColor Red
              $gmailComplete = $false
          } else {
              Write-Host "âœ… GMAIL_PASS is configured" -ForegroundColor Green
          }
          
          if ($gmailComplete) {
              "has-gmail=true" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
          } else {
              "has-gmail=false" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
              Write-Host "âš ï¸ Gmail configuration incomplete - email will be skipped" -ForegroundColor Yellow
          }
          
          # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙ„Ù…
          $recipientEmail = ""
          
          if ("${{ github.event.inputs.recipient-email }}" -ne "") {
              $recipientEmail = "${{ github.event.inputs.recipient-email }}"
              Write-Host "âœ… Recipient from input: $recipientEmail" -ForegroundColor Green
          } elseif ("${{ secrets.GMAIL_USER }}" -ne "") {
              $recipientEmail = "${{ secrets.GMAIL_USER }}"
              Write-Host "âœ… Recipient from GMAIL_USER: $recipientEmail" -ForegroundColor Green
          }
          
          "recipient=$recipientEmail" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
          
          # Ù…Ù„Ø®Øµ
          Write-Host "`nğŸ“‹ Configuration Summary:" -ForegroundColor Yellow
          Write-Host "  â€¢ Tailscale: $(if('${{ secrets.TAILSCALE_AUTH_KEY }}' -ne ''){'âœ…'}else{'âŒ'})" -ForegroundColor Cyan
          Write-Host "  â€¢ Gmail User: $(if('${{ secrets.GMAIL_USER }}' -ne ''){'âœ…'}else{'âŒ'})" -ForegroundColor Cyan
          Write-Host "  â€¢ Gmail Pass: $(if('${{ secrets.GMAIL_PASS }}' -ne ''){'âœ…'}else{'âŒ'})" -ForegroundColor Cyan
          Write-Host "  â€¢ Recipient: $recipientEmail" -ForegroundColor Cyan
          
          if ($hasErrors) {
              Write-Host "`nâŒ Configuration validation failed!" -ForegroundColor Red
              exit 1
          }
          
          Write-Host "`nâœ… Configuration validation passed!" -ForegroundColor Green

  tailscale-setup:
    name: ğŸ”— Setup Tailscale Network
    runs-on: ubuntu-latest
    needs: validate-config
    timeout-minutes: 15
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup PowerShell
        shell: bash
        run: |
          wget -q https://packages.microsoft.com/config/ubuntu/$(lsb_release -rs)/packages-microsoft-prod.deb
          sudo dpkg -i packages-microsoft-prod.deb
          sudo apt-get update
          sudo apt-get install -y powershell
          pwsh --version

      - name: ğŸ”— Install Tailscale
        shell: bash
        run: |
          echo "ğŸ“¦ Installing Tailscale..."
          curl -fsSL https://tailscale.com/install.sh | sh
          echo "âœ… Tailscale installed"
          
      - name: ğŸŒ Connect to Tailscale Network
        shell: bash
        run: |
          echo "ğŸ”— Connecting to Tailscale..."
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} \
            --hostname=github-runner-${{ github.run_number }} \
            --accept-routes
          echo "âœ… Connected successfully"
          
      - name: ğŸ“Š Get Tailscale Status
        shell: bash
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘           ğŸ”— TAILSCALE NETWORK STATUS                     â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“ My Tailscale IP:"
          sudo tailscale ip -4
          echo ""
          echo "ğŸŒ Connected Devices:"
          sudo tailscale status
          
      - name: ğŸ” Generate VM Credentials
        shell: pwsh
        run: |
          Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Magenta
          Write-Host "â•‘       ğŸ” GENERATING VM CREDENTIALS                        â•‘" -ForegroundColor Magenta
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Magenta
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯
          New-Item -ItemType Directory -Path "results" -Force | Out-Null
          
          # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Tailscale IP
          $tailscaleIP = (sudo tailscale ip -4).Trim()
          
          Write-Host "`nğŸ“ Tailscale IP: $tailscaleIP" -ForegroundColor Cyan
          
          # ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù‚ÙˆÙŠØ©
          $password = -join ((65..90) + (97..122) + (48..57) + (33..47) | Get-Random -Count 20 | ForEach-Object {[char]$_})
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø¹ØªÙ…Ø§Ø¯
          $credentials = @(
              @{
                  vmId = "github-runner-${{ github.run_number }}"
                  role = "runner"
                  status = "running"
                  hostname = "github-runner-${{ github.run_number }}"
                  publicIP = "N/A (GitHub-hosted)"
                  tailscaleIP = $tailscaleIP
                  username = "admin"
                  password = $password
                  sshCommand = "ssh admin@$tailscaleIP"
                  tailscaleNetwork = "Connected"
                  createdAt = (Get-Date -Format 'o')
                  expiresAt = ((Get-Date).AddHours(6).ToString('o'))
                  note = "GitHub Actions Runner - Connected via Tailscale VPN"
              }
          )
          
          # Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
          $credFile = "results/vm-credentials-$(Get-Date -Format 'yyyyMMdd-HHmmss').json"
          $credentials | ConvertTo-Json -Depth 10 | Set-Content $credFile
          
          Write-Host "`nâœ… Credentials generated successfully" -ForegroundColor Green
          Write-Host "ğŸ“„ Saved to: $credFile" -ForegroundColor Cyan
          
          # Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          Write-Host "`nğŸ“‹ Generated Credentials:" -ForegroundColor Yellow
          Write-Host "  â€¢ VM ID: $($credentials[0].vmId)" -ForegroundColor Cyan
          Write-Host "  â€¢ Tailscale IP: $($credentials[0].tailscaleIP)" -ForegroundColor Green
          Write-Host "  â€¢ Username: $($credentials[0].username)" -ForegroundColor Cyan
          Write-Host "  â€¢ Password: $($credentials[0].password)" -ForegroundColor Yellow
          Write-Host "  â€¢ SSH: $($credentials[0].sshCommand)" -ForegroundColor Cyan

      - name: ğŸ“¤ Upload Credentials Report
        uses: actions/upload-artifact@v4
        with:
          name: vm-credentials-${{ github.run_number }}
          path: results/vm-credentials-*.json
          retention-days: 7

      - name: ğŸ“§ Send Email Notification
        if: |
          (github.event.inputs.send-email == 'true' || github.event_name == 'schedule') &&
          needs.validate-config.outputs.has-gmail-config == 'true'
        shell: pwsh
        env:
          GMAIL_USER: ${{ secrets.GMAIL_USER }}
          GMAIL_PASS: ${{ secrets.GMAIL_PASS }}
          RECIPIENT_EMAIL: ${{ needs.validate-config.outputs.recipient-email }}
        run: |
          Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Green
          Write-Host "â•‘       ğŸ“§ SENDING EMAIL NOTIFICATION                       â•‘" -ForegroundColor Green
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green
          
          $recipientEmail = $env:RECIPIENT_EMAIL
          
          Write-Host "`nğŸ“§ Email Configuration:" -ForegroundColor Yellow
          Write-Host "  â€¢ From: $env:GMAIL_USER" -ForegroundColor Cyan
          Write-Host "  â€¢ To: $recipientEmail" -ForegroundColor Cyan
          Write-Host "  â€¢ SMTP: smtp.gmail.com:587" -ForegroundColor Cyan
          
          if ([string]::IsNullOrWhiteSpace($recipientEmail)) {
              Write-Host "`nâŒ No recipient email!" -ForegroundColor Red
              exit 0
          }
          
          # ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
          $credFile = Get-ChildItem "results/vm-credentials-*.json" | 
              Sort-Object LastWriteTime -Descending | 
              Select-Object -First 1
          
          if (-not $credFile) {
              Write-Host "âŒ Credentials file not found!" -ForegroundColor Red
              exit 0
          }
          
          $credentials = Get-Content $credFile.FullName | ConvertFrom-Json
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ HTML Ù„Ù„Ø¨Ø±ÙŠØ¯
          $htmlBody = @"
          <!DOCTYPE html>
          <html>
          <head>
              <style>
                  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; margin: 0; }
                  .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); overflow: hidden; }
                  .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
                  .header h1 { margin: 0; font-size: 28px; }
                  .content { padding: 30px; }
                  .alert { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; border-radius: 5px; }
                  .vm-card { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; margin: 20px 0; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
                  .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.1); }
                  .info-label { font-weight: bold; color: #555; }
                  .info-value { color: #333; font-family: 'Courier New', monospace; background: rgba(255,255,255,0.8); padding: 5px 10px; border-radius: 5px; }
                  .password { background: #fff3cd; font-weight: bold; padding: 10px; border-radius: 5px; text-align: center; font-size: 18px; letter-spacing: 2px; }
                  .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 12px; }
                  .btn { display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 30px; text-decoration: none; border-radius: 25px; margin: 10px 5px; font-weight: bold; }
                  .emoji { font-size: 24px; }
              </style>
          </head>
          <body>
              <div class="container">
                  <div class="header">
                      <div class="emoji">ğŸ”</div>
                      <h1>VM Credentials & Tailscale Access</h1>
                      <p>Secure VPN Connection Information</p>
                  </div>
                  
                  <div class="content">
                      <div class="alert">
                          âš ï¸ <strong>Important Security Notice:</strong><br>
                          This email contains sensitive credentials. Store them securely and delete this email after saving to a password manager.
                      </div>
                      
                      <h2>ğŸ–¥ï¸ Virtual Machine Details</h2>
                      
                      <div class="vm-card">
                          <h3>ğŸ”¹ $($credentials[0].vmId)</h3>
                          
                          <div class="info-row">
                              <span class="info-label">Role:</span>
                              <span class="info-value">$($credentials[0].role)</span>
                          </div>
                          
                          <div class="info-row">
                              <span class="info-label">Status:</span>
                              <span class="info-value">âœ… $($credentials[0].status)</span>
                          </div>
                          
                          <div class="info-row">
                              <span class="info-label">Tailscale IP:</span>
                              <span class="info-value" style="color: #28a745; font-weight: bold;">$($credentials[0].tailscaleIP)</span>
                          </div>
                          
                          <div class="info-row">
                              <span class="info-label">Username:</span>
                              <span class="info-value">$($credentials[0].username)</span>
                          </div>
                          
                          <div style="margin: 20px 0;">
                              <div class="info-label" style="margin-bottom: 10px;">ğŸ”‘ Password:</div>
                              <div class="password">$($credentials[0].password)</div>
                          </div>
                          
                          <div class="info-row">
                              <span class="info-label">SSH Command:</span>
                              <span class="info-value" style="background: #d4edda;">$($credentials[0].sshCommand)</span>
                          </div>
                          
                          <div class="info-row">
                              <span class="info-label">Created:</span>
                              <span class="info-value">$($credentials[0].createdAt)</span>
                          </div>
                          
                          <div class="info-row">
                              <span class="info-label">Expires:</span>
                              <span class="info-value" style="color: #dc3545;">$($credentials[0].expiresAt)</span>
                          </div>
                      </div>
                      
                      <h2>ğŸ”— Tailscale Setup Guide</h2>
                      
                      <ol style="line-height: 1.8;">
                          <li><strong>Install Tailscale</strong> on your device:<br>
                              <a href="https://tailscale.com/download" class="btn">Download Tailscale</a>
                          </li>
                          <li><strong>Connect</strong> to your Tailscale network</li>
                          <li><strong>Use SSH</strong> to connect:
                              <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; font-family: 'Courier New', monospace;">
                                  <code>$($credentials[0].sshCommand)</code>
                              </div>
                          </li>
                          <li><strong>Enter password</strong> when prompted</li>
                      </ol>
                      
                      <div class="alert" style="background: #d1ecf1; border-left-color: #17a2b8;">
                          ğŸ’¡ <strong>Pro Tip:</strong> Save these credentials in a secure password manager like 1Password, LastPass, or Bitwarden.
                      </div>
                  </div>
                  
                  <div class="footer">
                      <p>ğŸ¤– This is an automated message from GitHub Actions</p>
                      <p>Workflow Run #${{ github.run_number }} | Generated at $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss UTC')</p>
                      <p style="margin-top: 15px;">
                          <a href="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}">View Workflow Run</a>
                      </p>
                  </div>
              </div>
          </body>
          </html>
"@

          try {
              Write-Host "`nğŸ“¨ Preparing to send email..." -ForegroundColor Cyan
              
              # Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
              $securePassword = ConvertTo-SecureString $env:GMAIL_PASS -AsPlainText -Force
              $credential = New-Object System.Management.Automation.PSCredential($env:GMAIL_USER, $securePassword)
              
              # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ¯
              $mailParams = @{
                  From = $env:GMAIL_USER
                  To = $recipientEmail
                  Subject = "ğŸ” VM Credentials - Tailscale Network Access (Run #${{ github.run_number }})"
                  Body = $htmlBody
                  BodyAsHtml = $true
                  SmtpServer = "smtp.gmail.com"
                  Port = 587
                  UseSsl = $true
                  Credential = $credential
              }
              
              # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯
              Send-MailMessage @mailParams
              
              Write-Host "âœ… Email sent successfully to: $recipientEmail" -ForegroundColor Green
              
          } catch {
              Write-Host "âŒ Failed to send email: $_" -ForegroundColor Red
              Write-Host "`nğŸ’¡ Troubleshooting tips:" -ForegroundColor Yellow
              Write-Host "  â€¢ Verify GMAIL_USER and GMAIL_PASS secrets" -ForegroundColor Cyan
              Write-Host "  â€¢ Use App Password (not regular password)" -ForegroundColor Cyan
              Write-Host "  â€¢ Enable 2FA on Gmail and generate App Password" -ForegroundColor Cyan
              Write-Host "  â€¢ Check https://myaccount.google.com/apppasswords" -ForegroundColor Cyan
              Write-Host "`nğŸ“¥ You can download credentials from artifacts" -ForegroundColor Cyan
          }

      - name: ğŸ§¹ Cleanup
        if: always()
        shell: bash
        run: |
          echo "ğŸ§¹ Cleaning up..."
          sudo tailscale down || true
          echo "âœ… Cleanup completed"

  summary:
    name: ğŸ“‹ Summary
    runs-on: ubuntu-latest
    needs: [validate-config, tailscale-setup]
    if: always()
    
    steps:
      - name: ğŸ“Š Generate Summary
        shell: pwsh
        run: |
          Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Green
          Write-Host "â•‘       âœ… TAILSCALE DEPLOYMENT COMPLETED âœ…                 â•‘" -ForegroundColor Green
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green
          
          Write-Host "`nğŸ“Š Results:" -ForegroundColor Yellow
          Write-Host "  â€¢ Validation: ${{ needs.validate-config.result }}" -ForegroundColor Cyan
          Write-Host "  â€¢ Setup: ${{ needs.tailscale-setup.result }}" -ForegroundColor Cyan
          Write-Host "  â€¢ Email: ${{ needs.validate-config.outputs.recipient-email }}" -ForegroundColor Cyan
          
          Write-Host "`nğŸ“¥ Next Steps:" -ForegroundColor Yellow
          Write-Host "  1. Check your email for credentials" -ForegroundColor Cyan
          Write-Host "  2. Download artifacts if needed" -ForegroundColor Cyan
          Write-Host "  3. Install Tailscale on your device" -ForegroundColor Cyan
          Write-Host "  4. Connect and enjoy secure access!" -ForegroundColor Cyan

      - name: ğŸ“ Job Summary
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          # ğŸ”— Tailscale VPN Deployment
          
          ## âœ… Status
          
          - **Validation:** ${{ needs.validate-config.result }}
          - **Setup:** ${{ needs.tailscale-setup.result }}
          - **Email Sent To:** `${{ needs.validate-config.outputs.recipient-email }}`
          
          ## ğŸ“¥ Download Credentials
          
          Check the **Artifacts** section to download VM credentials.
          
          ## ğŸ”— Quick Start
          
          ```bash
          # 1. Install Tailscale
          curl -fsSL https://tailscale.com/install.sh | sh
          
          # 2. Connect
          sudo tailscale up
          
          # 3. SSH to VM (use credentials from email)
          ssh admin@<tailscale-ip>
          ```
          
          ---
          *Run #${{ github.run_number }} - $(date -u)*
          EOF
