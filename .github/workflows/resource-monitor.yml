  # Ø£Ø¶Ù Ù‡Ø°Ø§ Job ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
  check-quota:
    name: ğŸ’° Check Resource Quota
    runs-on: ubuntu-latest
    timeout-minutes: 5
    outputs:
      has-quota: ${{ steps.check.outputs.has-quota }}
      usage-percentage: ${{ steps.check.outputs.usage-percentage }}
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup PowerShell
        shell: bash
        run: |
          wget -q https://packages.microsoft.com/config/ubuntu/$(lsb_release -rs)/packages-microsoft-prod.deb
          sudo dpkg -i packages-microsoft-prod.deb
          sudo apt-get update
          sudo apt-get install -y powershell

      - name: ğŸ’° Check Quota
        id: check
        shell: pwsh
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPOSITORY_OWNER: ${{ github.repository_owner }}
        run: |
          Write-Host "Checking resource quota..." -ForegroundColor Cyan
          
          try {
              $headers = @{
                  "Authorization" = "Bearer $env:GITHUB_TOKEN"
                  "Accept" = "application/vnd.github+json"
              }
              
              $owner = $env:GITHUB_REPOSITORY_OWNER
              $url = "https://api.github.com/users/$owner/settings/billing/actions"
              
              $usage = Invoke-RestMethod -Uri $url -Headers $headers -Method Get
              
              $used = $usage.total_minutes_used
              $total = $usage.included_minutes
              $remaining = $total - $used
              $percentage = [math]::Round(($used / $total) * 100, 2)
              
              Write-Host "Usage: $used / $total minutes ($percentage%)" -ForegroundColor Cyan
              Write-Host "Remaining: $remaining minutes" -ForegroundColor Green
              
              $hasQuota = $remaining -gt 60  # Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø³Ø§Ø¹Ø© Ù…ØªØ¨Ù‚ÙŠØ©
              
              "has-quota=$($hasQuota.ToString().ToLower())" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
              "usage-percentage=$percentage" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
              
              if (-not $hasQuota) {
                  Write-Host "âš ï¸ WARNING: Low quota! Only $remaining minutes remaining" -ForegroundColor Yellow
              }
              
          } catch {
              Write-Host "âš ï¸ Could not check quota: $_" -ForegroundColor Yellow
              # Ø§ÙØªØ±Ø§Ø¶ ÙˆØ¬ÙˆØ¯ Ø±ØµÙŠØ¯ Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±
              "has-quota=true" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
              "usage-percentage=0" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
          }

  # Ø¹Ø¯Ù„ Ø§Ù„Ù€ orchestrator Ù„ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ check-quota
  orchestrator:
    name: ğŸ­ System Orchestrator
    runs-on: ubuntu-latest
    needs: check-quota
    # Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø´Ø±Ø·
    if: needs.check-quota.outputs.has-quota == 'true'
    # ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯
